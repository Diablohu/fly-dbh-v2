---
import { actions } from "astro:actions";
import { type VideoListPageTypesType } from "@/types";

import VideoListGrid from "@/components/video-list-grid";

type Props = {
    type?: VideoListPageTypesType;
    slug?: string;
    isIndex: boolean;
};
const length = 20;

const { data, error: error } = await Astro.callAction(
    actions.videoListPageFetch,
    {
        type: Astro.props.type,
        slug: Astro.props.slug,
        from: 0,
        length,
    }
);
if (error) {
    console.trace(error);
    Astro.response.status = 500;
    // Astro.response.statusText = (error.cause || error.message || "") as string;
    return Astro.rewrite("/500");
}
---

<section class="list">
    <h1>
        {
            Astro.props.isIndex ? (
                "最新模拟飞行视频"
            ) : (
                <Fragment>
                    <small>{Astro.props.type}</small>
                    {Astro.params.slug}
                </Fragment>
            )
        }
    </h1>
    <hr />

    {
        Astro.props.isIndex ? null : (
            <Fragment>
                <section class="info">INFO: {Astro.params.slug}</section>
                <hr />
            </Fragment>
        )
    }

    <section class="video-list">
        <VideoListGrid
            client:idle
            type={Astro.props.type}
            slug={Astro.props.slug}
            isIndex={Astro.props.isIndex}
            length={length}
            initialList={data.list}
            initialListIsComplete={data.list.length >= data.total}
            infiniteScroll
        />
    </section>
</section>

<style lang="less">
    @import "@/utils/mixins.less";

    .list {
        flex: 1;
        order: 2;
        padding-top: 2em;
        padding-bottom: 4em;

        h1 {
            margin: 0;
        }

        .info {
            background: var(--tag-background-color);
            border-radius: 10px;
            padding: 1em;
        }

        .video-list {
            padding: 1em 0;
        }
    }
</style>
